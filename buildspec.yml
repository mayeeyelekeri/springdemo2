version: 0.1

phases:

  install:
    runtime-versions:
      java: corretto17
    commands:
      - echo Pre-Build started on `date`
      - echo before install 
      - yum install -y wget unzip zip jq 
      - wget https://download.java.net/java/GA/jdk18/43f95e8614114aeaa8e8a5fcf20a682d/36/GPL/openjdk-18_linux-x64_bin.tar.gz -P /tmp
      - tar xzf /tmp/openjdk-18_linux-x64_bin.tar.gz -C /opt
      - rm -rf /tmp/openjdk-18_linux-x64_bin.tar.gz
      - java --version 
      - javac --version 
      - ls -lrt /usr/bin/java 
      - ls -lrt /usr/bin/javac 
      - which java 
      - which javac 
      - echo before install 
      - update-alternatives --install /usr/bin/java java /opt/jdk-18/bin/java 3
      - update-alternatives --install /usr/bin/javac javac /opt/jdk-18/bin/javac 3

  build:
    commands:
      - echo Build started on `date`
      - echo after install 
      - set JAVA_HOME=/opt/jdk-18
      - set PATH=/opt/jdk-18/bin:$PATH
      - javac --version 
      - java --version
      - which java 
      - which javac 
      - ls -lrt /usr/bin/java 
      - ls -lrt /usr/bin/javac 
      - mvn clean package
      - echo Build Ended on `date`

  post_build:
    commands:
      - echo bucket name is $BUCKET_NAME
      - cp target/springdemo2-1.0.0-SNAPSHOT.jar codedeploy 
      - ls -lrt codedeploy
      - cd codedeploy && zip -r ../springdemo2.zip * 
      - ls -lrt springdemo2.zip
artifacts:
  files:
    - springdemo2.zip
  discard-paths: yes
